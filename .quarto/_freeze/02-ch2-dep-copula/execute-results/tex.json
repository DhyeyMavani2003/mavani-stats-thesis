{
  "hash": "d5f9b837bc58e9a2b0ea3b7a367b3ea0",
  "result": {
    "engine": "knitr",
    "markdown": "# Unraveling Notion of Dependence through Copulas {#sec-simple}\n\n\n\n\n\nIn this chapter, we introduce the concept of copulas and the necessary preliminary concepts, including probability transformations, quantile functions, and dependence measures. Let's start by defining some mathematical notation & objects that we will use throughout this chapter.\n\nDefine $\\mathbb{R}$ as the real line $(-\\infty, \\infty)$ and $\\mathbb{R}^2$ as the real plane $\\mathbb{R} \\times \\mathbb{R}$. A rectangle in the real plane is defined by the Cartesian product of two closed intervals: $[x_1, x_2] \\times [y_1, y_2]$, where the vertices of the rectangle are $(x_1, y_1), (x_1, y_2), (x_2, y_1), (x_2, y_2)$. We denote the unit interval as $\\mathbb{I} = [0,1]$, with $\\mathbb{I}^2 = [0,1] \\times [0,1]$ representing the unit square.\n\n### Probability Integral Transformation\n\n**Lemma 1** (Probability Integral Transformation):  \nLet $F$ be a continuous distribution function, and let $X \\sim F$. Then the transformed variable $F(X)$ follows a standard uniform distribution, i.e., $F(X) \\sim U(0,1)$.\n\nTo illustrate this concept, let’s generate a random sample from a normal distribution, apply the transformation, and plot the results.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Probability Integral Transformation of a Normally Distributed Sample.](02-ch2-dep-copula_files/figure-pdf/fig-probability-integral-transform-1.pdf){#fig-probability-integral-transform}\n:::\n:::\n\n\n### Quantile Function\n\nThe quantile function $F^{-1}$ is defined as:\n$$\nF^{-1}(y) = \\inf \\{ x \\in \\mathbb{R} : F(x) \\geq y \\}, \\quad y \\in [0,1].\n$$\n\nFor continuous and strictly increasing distribution functions $F$, $F^{-1} = F^{-1}$. However, if $F$ is not strictly increasing, it may not have an inverse in the usual sense.\n\n**Lemma 2** (Quantile Transform):  \nLet $U \\sim U(0,1)$ and let $F$ be any distribution function. Then $F^{-1}(U) \\sim F$.\n\nTo demonstrate this, we can generate a uniform sample, apply the inverse transformation of a normal distribution, and compare the results.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Quantile Transformation from Uniform to Normal Distribution.](02-ch2-dep-copula_files/figure-pdf/fig-quantile-transform-1.pdf){#fig-quantile-transform}\n:::\n:::\n\n\n## A Motivating Example: Comparison of Dependence\n\nSuppose we have two bivariate datasets, each consisting of 1000 independent observations from a bivariate random vector $(X_1, X_2)$ and $(Y_1, Y_2)$, respectively. We aim to analyze the dependence between the components of each dataset.\n\nTo explore this, let’s calculate and compare the Pearson correlation coefficient for each dataset.\n\n\n::: {#tbl-correlation-coefficients .cell tbl-cap='Pearson Correlation Coefficients for Bivariate Datasets (X1, X2) and (Y1, Y2).'}\n::: {.cell-output-display}\n\\begin{table}\n\\fontsize{12.0pt}{14.4pt}\\selectfont\n\\begin{tabular*}{\\linewidth}{@{\\extracolsep{\\fill}}lr}\n\\toprule\nVariable Pair & Pearson Correlation \\\\ \n\\midrule\\addlinespace[2.5pt]\n(X1, X2) & 0.91956301 \\\\ \n(Y1, Y2) & -0.05467525 \\\\ \n\\bottomrule\n\\end{tabular*}\n\\end{table}\n\n:::\n:::\n\n\n### Visualizing Dependence Structures\n\nLet’s plot scatterplots of $(X_1, X_2)$ and $(Y_1, Y_2)$ to visually examine the dependence structures.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Scatterplots of (X1, X2) and (Y1, Y2) showing different dependence structures.](02-ch2-dep-copula_files/figure-pdf/fig-scatter-dependence-1.pdf){#fig-scatter-dependence}\n:::\n:::\n\n\n## Copulas\n\nCopulas enable the study of dependence independent of marginal distributions. A copula is a distribution function with standard uniform marginals. By transforming marginals to a standard uniform scale, copulas can be used to compare different dependency structures on an equal footing.\n\n### Subcopula Definition\n\nA 2-dimensional subcopula $C^S$ is defined on $D_1 \\times D_2 \\rightarrow [0,1]$, where:\n1. **Grounded**: $C^S(u, 0) = 0 = C^S(0, v)$ for all $u, v \\in D_1 \\times D_2$.\n2. **2-increasing**: $C^S(u_2, v_2) - C^S(u_1, v_2) - C^S(u_2, v_1) + C^S(u_1, v_1) \\geq 0$, for $u_1 \\leq u_2$ and $v_1 \\leq v_2$.\n\n### Visualizing Uniform Marginals using Copula Transform\n\nTo illustrate this concept, we can apply the copula transformation to both datasets and observe the transformed data. The transformed data for each dataset should now follow a standard uniform distribution on both axes.\n\n\n::: {.cell}\n::: {.cell-output-display}\n![Copula Transformation on (X1, X2) and (Y1, Y2) to Uniform Margins.](02-ch2-dep-copula_files/figure-pdf/fig-copula-transform-1.pdf){#fig-copula-transform}\n:::\n:::\n\n\n## Figures\n\nConsider customizing your plot themes per-plot---as we do below to create @fig-wnba-ht<!---->---or changing the default `ggplot()` theme in your document within your `setup` code chunks using `ggplot2::theme_set()`.\n\nIf **ggplot2** is loaded, the following code sets the default `ggplot()` theme to `theme_classic()`.\n<!-- \nThe markdown syntax below will use R syntax highlighting to display the code, but it is not a \"true\" code chunk in the sense that the code is displayed but not evaluated in the rendered document.\n-->\n\n```r\ntheme_set(theme_classic())\n```\n\n\n## Tables\n\nYour tables should be publication quality. Consider using [**gt**](https://gt.rstudio.com/articles/gt.html) [@gt] or  [**kableExtra**](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_pdf.pdf) [@kableExtra] to customize your tables. The [**gtsummary**](https://www.danieldsjoberg.com/gtsummary/) package [@gtsummary] may also come in handy.\n\n@tbl-ht-by-pos shows the average heights of WNBA players by position. \n\n\n\n<!-- \nThe following section should be included at the end of each chapter that contains code.\n\nNote that this will include code from code chunks even if `eval` is set to `false`.\n-->\n\n## @sec-simple Code\n\nThe following code was used to create @sec-simple.\n\n### Code within chapter\n\n::: {.cell}\n\n```{.r .cell-code}\n# Load packages\nlibrary(tidyverse)\nlibrary(gt)\n\n# Set default ggplot theme for document\ntheme_set(theme_classic())\n# If using kableExtra tables, print blank cells instead of `NA`\noptions(knitr.kable.NA = \"\")\n# Generate random normal sample\nset.seed(8990)\nnormal_sample <- rnorm(1000)\n\n# Apply transformation\nuniform_sample <- pnorm(normal_sample)\n\n# Plot both original and transformed samples\ndata.frame(normal_sample, uniform_sample) %>%\n  pivot_longer(cols = everything(), names_to = \"Distribution\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, fill = Distribution)) +\n  geom_histogram(bins = 30, alpha = 0.6, position = \"identity\") +\n  facet_wrap(~ Distribution, scales = \"free\") +\n  labs(x = \"Value\", y = \"Count\") +\n  theme_bw()\n# Generate uniform sample\nset.seed(8990)\nuniform_sample <- runif(1000)\n\n# Apply inverse transform (quantile function of normal)\nnormal_quantile_sample <- qnorm(uniform_sample)\n\n# Plot both original and transformed samples\ndata.frame(uniform_sample, normal_quantile_sample) %>%\n  pivot_longer(cols = everything(), names_to = \"Distribution\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, fill = Distribution)) +\n  geom_histogram(bins = 30, alpha = 0.6, position = \"identity\") +\n  facet_wrap(~ Distribution, scales = \"free\") +\n  labs(x = \"Value\", y = \"Count\") +\n  theme_bw()\n# Generate synthetic data\nset.seed(8990)\nx1 <- rnorm(1000)\nx2 <- 0.7 * x1 + rnorm(1000, sd = 0.3)\ny1 <- rbeta(1000, 5, 10)\ny2 <- rexp(1000, rate = 1)\n\n# Calculate correlation\ncorrelations <- data.frame(\n  Pair = c(\"(X1, X2)\", \"(Y1, Y2)\"),\n  Correlation = c(cor(x1, x2), cor(y1, y2))\n)\n\ncorrelations %>%\n  gt() %>%\n  cols_label(\n    Pair = \"Variable Pair\",\n    Correlation = \"Pearson Correlation\"\n  )\ndata.frame(X1 = x1, X2 = x2, Y1 = y1, Y2 = y2) %>%\n  pivot_longer(cols = everything(), names_to = \"Variable\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, y = ifelse(Variable %in% c(\"X1\", \"X2\"), x2, y2), color = Variable)) +\n  geom_point(alpha = 0.4) +\n  facet_wrap(~ Variable, scales = \"free\") +\n  labs(x = \"Variable\", y = \"Dependence Structure\") +\n  theme_minimal()\n# Apply copula transform\ntransformed_x1 <- pnorm(x1)\ntransformed_x2 <- pnorm(x2)\ntransformed_y1 <- pnorm(y1, mean = mean(y1), sd = sd(y1))\ntransformed_y2 <- pnorm(y2, mean = mean(y2), sd = sd(y2))\n\n# Plot transformed datasets\ndata.frame(FX1 = transformed_x1, FX2 = transformed_x2, GY1 = transformed_y1, GY2 = transformed_y2) %>%\n  pivot_longer(cols = everything(), names_to = \"Variable\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, y = ifelse(Variable %in% c(\"FX1\", \"FX2\"), transformed_x2, transformed_y2), color = Variable)) +\n  geom_point(alpha = 0.4) +\n  facet_wrap(~ Variable, scales = \"free\") +\n  labs(x = \"Transformed Value\", y =\n\n \"Uniform Margins\") +\n  theme_minimal()\n# =======================================================================\n# Sample R script for thesis template\n#\n# Cleans temp_raw_wnba.csv dataset, which contains data pulled from\n# https://www.espn.com/wnba/stats/player on 2024/06/19\n#\n# Last updated: 2024/06/19\n# =======================================================================\nlibrary(tidyverse)\n\nwnba <- read_csv(\"data/temp_raw_wnba.csv\") |> \n  janitor::clean_names() |> \n  # Pull jersey numbers off of names and \n  # turn height text into msmt (6'4\" = 6.3333)\n  mutate(jersey = str_extract(name, \"[0-9]+$\"),\n         name = str_remove(name, \"[0-9]+$\"),\n         ht_ft = parse_number(str_extract(ht, \"^[0-9]\")),\n         ht_in = parse_number(str_extract(ht, '[0-9]+\\\\\"$')),\n         height = ht_ft * 12 + ht_in,\n         weight = parse_number(wt),\n         position = factor(pos,\n                           levels = c(\"G\", \"F\", \"C\"),\n                           labels = c(\"Guard\", \"Forward\", \"Center\"))) |> \n  select(-c(ht, wt, ht_ft, ht_in, pos))\n  \nsave(wnba, file = \"data/temp_wnba.RData\")\n```\n:::\n\n\n### Code sourced from external scripts\n\n::: {.cell}\n\n```{.r .cell-code}\n# =======================================================================\n# Sample R script for thesis template\n#\n# Cleans temp_raw_wnba.csv dataset, which contains data pulled from\n# https://www.espn.com/wnba/stats/player on 2024/06/19\n#\n# Last updated: 2024/06/19\n# =======================================================================\nlibrary(tidyverse)\n\nwnba <- read_csv(\"data/temp_raw_wnba.csv\") |> \n  janitor::clean_names() |> \n  # Pull jersey numbers off of names and \n  # turn height text into msmt (6'4\" = 6.3333)\n  mutate(jersey = str_extract(name, \"[0-9]+$\"),\n         name = str_remove(name, \"[0-9]+$\"),\n         ht_ft = parse_number(str_extract(ht, \"^[0-9]\")),\n         ht_in = parse_number(str_extract(ht, '[0-9]+\\\\\"$')),\n         height = ht_ft * 12 + ht_in,\n         weight = parse_number(wt),\n         position = factor(pos,\n                           levels = c(\"G\", \"F\", \"C\"),\n                           labels = c(\"Guard\", \"Forward\", \"Center\"))) |> \n  select(-c(ht, wt, ht_ft, ht_in, pos))\n  \nsave(wnba, file = \"data/temp_wnba.RData\")\n```\n:::\n",
    "supporting": [
      "02-ch2-dep-copula_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {
      "knitr": [
        "{\"type\":\"list\",\"attributes\":{\"knit_meta_id\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"tbl-correlation-coefficients\",\"tbl-correlation-coefficients\",\"tbl-correlation-coefficients\",\"tbl-correlation-coefficients\",\"tbl-correlation-coefficients\",\"tbl-correlation-coefficients\",\"tbl-correlation-coefficients\"]}},\"value\":[{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"booktabs\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"caption\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"longtable\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"colortbl\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"array\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"anyfontsize\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]},{\"type\":\"list\",\"attributes\":{\"names\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"name\",\"options\",\"extra_lines\"]},\"class\":{\"type\":\"character\",\"attributes\":{},\"value\":[\"latex_dependency\"]}},\"value\":[{\"type\":\"character\",\"attributes\":{},\"value\":[\"multirow\"]},{\"type\":\"NULL\"},{\"type\":\"NULL\"}]}]}"
      ]
    },
    "preserve": null,
    "postProcess": false
  }
}