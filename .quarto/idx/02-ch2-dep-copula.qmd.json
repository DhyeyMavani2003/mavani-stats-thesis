{"title":"Unraveling Notion of Dependence through Copulas","markdown":{"headingText":"Unraveling Notion of Dependence through Copulas","headingAttr":{"id":"sec-simple","classes":[],"keyvalue":[]},"containsRefs":false,"markdown":"\n```{r}\n#| label: setup\n#| include: false\n\n# Load packages\nlibrary(tidyverse)\nlibrary(gt)\n\n# Set default ggplot theme for document\ntheme_set(theme_classic())\n# If using kableExtra tables, print blank cells instead of `NA`\noptions(knitr.kable.NA = \"\")\n```\n\nIn this chapter, we introduce the concept of copulas and the necessary preliminary concepts, including probability transformations, quantile functions, and dependence measures. Let's start by defining some mathematical notation & objects that we will use throughout this chapter.\n\nDefine $\\mathbb{R}$ as the real line $(-\\infty, \\infty)$ and $\\mathbb{R}^2$ as the real plane $\\mathbb{R} \\times \\mathbb{R}$. A rectangle in the real plane is defined by the Cartesian product of two closed intervals: $[x_1, x_2] \\times [y_1, y_2]$, where the vertices of the rectangle are $(x_1, y_1), (x_1, y_2), (x_2, y_1), (x_2, y_2)$. We denote the unit interval as $\\mathbb{I} = [0,1]$, with $\\mathbb{I}^2 = [0,1] \\times [0,1]$ representing the unit square.\n\n### Probability Integral Transformation\n\n**Lemma 1** (Probability Integral Transformation):  \nLet $F$ be a continuous distribution function, and let $X \\sim F$. Then the transformed variable $F(X)$ follows a standard uniform distribution, i.e., $F(X) \\sim U(0,1)$.\n\nTo illustrate this concept, let’s generate a random sample from a normal distribution, apply the transformation, and plot the results.\n\n```{r}\n#| label: fig-probability-integral-transform\n#| fig-cap: \"Probability Integral Transformation of a Normally Distributed Sample.\"\n#| fig-width: 6\n#| fig-height: 4\n#| fig-dpi: 150\n\n# Generate random normal sample\nset.seed(8990)\nnormal_sample <- rnorm(1000)\n\n# Apply transformation\nuniform_sample <- pnorm(normal_sample)\n\n# Plot both original and transformed samples\ndata.frame(normal_sample, uniform_sample) %>%\n  pivot_longer(cols = everything(), names_to = \"Distribution\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, fill = Distribution)) +\n  geom_histogram(bins = 30, alpha = 0.6, position = \"identity\") +\n  facet_wrap(~ Distribution, scales = \"free\") +\n  labs(x = \"Value\", y = \"Count\") +\n  theme_bw()\n```\n\n### Quantile Function\n\nThe quantile function $F^{-1}$ is defined as:\n$$\nF^{-1}(y) = \\inf \\{ x \\in \\mathbb{R} : F(x) \\geq y \\}, \\quad y \\in [0,1].\n$$\n\nFor continuous and strictly increasing distribution functions $F$, $F^{-1} = F^{-1}$. However, if $F$ is not strictly increasing, it may not have an inverse in the usual sense.\n\n**Lemma 2** (Quantile Transform):  \nLet $U \\sim U(0,1)$ and let $F$ be any distribution function. Then $F^{-1}(U) \\sim F$.\n\nTo demonstrate this, we can generate a uniform sample, apply the inverse transformation of a normal distribution, and compare the results.\n\n```{r}\n#| label: fig-quantile-transform\n#| fig-cap: \"Quantile Transformation from Uniform to Normal Distribution.\"\n#| fig-width: 6\n#| fig-height: 4\n#| fig-dpi: 150\n\n# Generate uniform sample\nset.seed(8990)\nuniform_sample <- runif(1000)\n\n# Apply inverse transform (quantile function of normal)\nnormal_quantile_sample <- qnorm(uniform_sample)\n\n# Plot both original and transformed samples\ndata.frame(uniform_sample, normal_quantile_sample) %>%\n  pivot_longer(cols = everything(), names_to = \"Distribution\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, fill = Distribution)) +\n  geom_histogram(bins = 30, alpha = 0.6, position = \"identity\") +\n  facet_wrap(~ Distribution, scales = \"free\") +\n  labs(x = \"Value\", y = \"Count\") +\n  theme_bw()\n```\n\n## A Motivating Example: Comparison of Dependence\n\nSuppose we have two bivariate datasets, each consisting of 1000 independent observations from a bivariate random vector $(X_1, X_2)$ and $(Y_1, Y_2)$, respectively. We aim to analyze the dependence between the components of each dataset.\n\nTo explore this, let’s calculate and compare the Pearson correlation coefficient for each dataset.\n\n```{r}\n#| label: tbl-correlation-coefficients\n#| tbl-cap: \"Pearson Correlation Coefficients for Bivariate Datasets (X1, X2) and (Y1, Y2).\"\n#| fig-width: 6\n#| fig-height: 4\n#| fig-dpi: 150\n\n# Generate synthetic data\nset.seed(8990)\nx1 <- rnorm(1000)\nx2 <- 0.7 * x1 + rnorm(1000, sd = 0.3)\ny1 <- rbeta(1000, 5, 10)\ny2 <- rexp(1000, rate = 1)\n\n# Calculate correlation\ncorrelations <- data.frame(\n  Pair = c(\"(X1, X2)\", \"(Y1, Y2)\"),\n  Correlation = c(cor(x1, x2), cor(y1, y2))\n)\n\ncorrelations %>%\n  gt() %>%\n  cols_label(\n    Pair = \"Variable Pair\",\n    Correlation = \"Pearson Correlation\"\n  )\n```\n\n### Visualizing Dependence Structures\n\nLet’s plot scatterplots of $(X_1, X_2)$ and $(Y_1, Y_2)$ to visually examine the dependence structures.\n\n```{r}\n#| label: fig-scatter-dependence\n#| fig-cap: \"Scatterplots of (X1, X2) and (Y1, Y2) showing different dependence structures.\"\n#| fig-width: 6\n#| fig-height: 4\n#| fig-dpi: 150\n\ndata.frame(X1 = x1, X2 = x2, Y1 = y1, Y2 = y2) %>%\n  pivot_longer(cols = everything(), names_to = \"Variable\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, y = ifelse(Variable %in% c(\"X1\", \"X2\"), x2, y2), color = Variable)) +\n  geom_point(alpha = 0.4) +\n  facet_wrap(~ Variable, scales = \"free\") +\n  labs(x = \"Variable\", y = \"Dependence Structure\") +\n  theme_minimal()\n```\n\n## Copulas\n\nCopulas enable the study of dependence independent of marginal distributions. A copula is a distribution function with standard uniform marginals. By transforming marginals to a standard uniform scale, copulas can be used to compare different dependency structures on an equal footing.\n\n### Subcopula Definition\n\nA 2-dimensional subcopula $C^S$ is defined on $D_1 \\times D_2 \\rightarrow [0,1]$, where:\n1. **Grounded**: $C^S(u, 0) = 0 = C^S(0, v)$ for all $u, v \\in D_1 \\times D_2$.\n2. **2-increasing**: $C^S(u_2, v_2) - C^S(u_1, v_2) - C^S(u_2, v_1) + C^S(u_1, v_1) \\geq 0$, for $u_1 \\leq u_2$ and $v_1 \\leq v_2$.\n\n### Visualizing Uniform Marginals using Copula Transform\n\nTo illustrate this concept, we can apply the copula transformation to both datasets and observe the transformed data. The transformed data for each dataset should now follow a standard uniform distribution on both axes.\n\n```{r}\n#| label: fig-copula-transform\n#| fig-cap: \"Copula Transformation on (X1, X2) and (Y1, Y2) to Uniform Margins.\"\n#| fig-width: 6\n#| fig-height: 4\n#| fig-dpi: 150\n\n# Apply copula transform\ntransformed_x1 <- pnorm(x1)\ntransformed_x2 <- pnorm(x2)\ntransformed_y1 <- pnorm(y1, mean = mean(y1), sd = sd(y1))\ntransformed_y2 <- pnorm(y2, mean = mean(y2), sd = sd(y2))\n\n# Plot transformed datasets\ndata.frame(FX1 = transformed_x1, FX2 = transformed_x2, GY1 = transformed_y1, GY2 = transformed_y2) %>%\n  pivot_longer(cols = everything(), names_to = \"Variable\", values_to = \"Value\") %>%\n  ggplot(aes(x = Value, y = ifelse(Variable %in% c(\"FX1\", \"FX2\"), transformed_x2, transformed_y2), color = Variable)) +\n  geom_point(alpha = 0.4) +\n  facet_wrap(~ Variable, scales = \"free\") +\n  labs(x = \"Transformed Value\", y =\n\n \"Uniform Margins\") +\n  theme_minimal()\n```\n\n## Figures\n\nConsider customizing your plot themes per-plot---as we do below to create @fig-wnba-ht<!---->---or changing the default `ggplot()` theme in your document within your `setup` code chunks using `ggplot2::theme_set()`.\n\nIf **ggplot2** is loaded, the following code sets the default `ggplot()` theme to `theme_classic()`.\n<!-- \nThe markdown syntax below will use R syntax highlighting to display the code, but it is not a \"true\" code chunk in the sense that the code is displayed but not evaluated in the rendered document.\n-->\n\n```r\ntheme_set(theme_classic())\n```\n\n\n## Tables\n\nYour tables should be publication quality. Consider using [**gt**](https://gt.rstudio.com/articles/gt.html) [@gt] or  [**kableExtra**](https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_pdf.pdf) [@kableExtra] to customize your tables. The [**gtsummary**](https://www.danieldsjoberg.com/gtsummary/) package [@gtsummary] may also come in handy.\n\n@tbl-ht-by-pos shows the average heights of WNBA players by position. \n\n\n\n<!-- \nThe following section should be included at the end of each chapter that contains code.\n\nNote that this will include code from code chunks even if `eval` is set to `false`.\n-->\n\n## @sec-simple Code\n\nThe following code was used to create @sec-simple.\n\n### Code within chapter\n```{r}\n#| echo: true\n#| eval: false\n#| ref-label: !expr knitr::all_labels()\n```\n\n### Code sourced from external scripts\n```{r}\n#| echo: true\n#| eval: false\n{{< include src/temp01-clean-wnba.R >}}\n```\n","srcMarkdownNoYaml":""},"formats":{"amherst-thesis-pdf":{"identifier":{"display-name":"PDF","target-format":"amherst-thesis-pdf","base-format":"pdf","extension-name":"amherst-thesis"},"execute":{"fig-width":3.6,"fig-height":2.4,"fig-format":"pdf","fig-dpi":300,"df-print":"default","error":false,"eval":true,"cache":null,"freeze":false,"echo":true,"output":true,"warning":true,"include":true,"keep-md":false,"keep-ipynb":false,"ipynb":null,"enabled":null,"daemon":null,"daemon-restart":false,"debug":false,"ipynb-filters":[],"ipynb-shell-interactivity":null,"plotly-connected":true,"engine":"knitr"},"render":{"keep-tex":false,"keep-typ":false,"keep-source":false,"keep-hidden":false,"prefer-html":false,"output-divs":true,"output-ext":"pdf","fig-align":"default","fig-pos":null,"fig-env":null,"code-fold":"none","code-overflow":"scroll","code-link":false,"code-line-numbers":true,"code-tools":false,"tbl-colwidths":true,"merge-includes":true,"inline-includes":false,"preserve-yaml":false,"latex-auto-mk":true,"latex-auto-install":true,"latex-clean":true,"latex-min-runs":1,"latex-max-runs":10,"latex-makeindex":"makeindex","latex-makeindex-opts":[],"latex-tlmgr-opts":[],"latex-input-paths":[],"latex-output-dir":null,"link-external-icon":false,"link-external-newwindow":false,"self-contained-math":false,"format-resources":[],"shortcodes":[]},"pandoc":{"pdf-engine":"pdflatex","standalone":true,"variables":{"graphics":true,"tables":true},"default-image-extension":"pdf","to":"pdf","toc-depth":2,"number-sections":true,"highlight-style":"atom-one","filters":[],"output-file":"02-ch2-dep-copula.pdf"},"language":{"toc-title-document":"Table of contents","toc-title-website":"On this page","related-formats-title":"Other Formats","related-notebooks-title":"Notebooks","source-notebooks-prefix":"Source","other-links-title":"Other Links","code-links-title":"Code Links","launch-dev-container-title":"Launch Dev Container","launch-binder-title":"Launch Binder","article-notebook-label":"Article Notebook","notebook-preview-download":"Download Notebook","notebook-preview-download-src":"Download Source","notebook-preview-back":"Back to Article","manuscript-meca-bundle":"MECA Bundle","section-title-abstract":"Abstract","section-title-appendices":"Appendices","section-title-footnotes":"Footnotes","section-title-references":"References","section-title-reuse":"Reuse","section-title-copyright":"Copyright","section-title-citation":"Citation","appendix-attribution-cite-as":"For attribution, please cite this work as:","appendix-attribution-bibtex":"BibTeX citation:","title-block-author-single":"Author","title-block-author-plural":"Authors","title-block-affiliation-single":"Affiliation","title-block-affiliation-plural":"Affiliations","title-block-published":"Published","title-block-modified":"Modified","title-block-keywords":"Keywords","callout-tip-title":"Tip","callout-note-title":"Note","callout-warning-title":"Warning","callout-important-title":"Important","callout-caution-title":"Caution","code-summary":"Code","code-tools-menu-caption":"Code","code-tools-show-all-code":"Show All Code","code-tools-hide-all-code":"Hide All Code","code-tools-view-source":"View Source","code-tools-source-code":"Source Code","tools-share":"Share","tools-download":"Download","code-line":"Line","code-lines":"Lines","copy-button-tooltip":"Copy to Clipboard","copy-button-tooltip-success":"Copied!","repo-action-links-edit":"Edit this page","repo-action-links-source":"View source","repo-action-links-issue":"Report an issue","back-to-top":"Back to top","search-no-results-text":"No results","search-matching-documents-text":"matching documents","search-copy-link-title":"Copy link to search","search-hide-matches-text":"Hide additional matches","search-more-match-text":"more match in this document","search-more-matches-text":"more matches in this document","search-clear-button-title":"Clear","search-text-placeholder":"","search-detached-cancel-button-title":"Cancel","search-submit-button-title":"Submit","search-label":"Search","toggle-section":"Toggle section","toggle-sidebar":"Toggle sidebar navigation","toggle-dark-mode":"Toggle dark mode","toggle-reader-mode":"Toggle reader mode","toggle-navigation":"Toggle navigation","crossref-fig-title":"Figure","crossref-tbl-title":"Table","crossref-lst-title":"Listing","crossref-thm-title":"Theorem","crossref-lem-title":"Lemma","crossref-cor-title":"Corollary","crossref-prp-title":"Proposition","crossref-cnj-title":"Conjecture","crossref-def-title":"Definition","crossref-exm-title":"Example","crossref-exr-title":"Exercise","crossref-ch-prefix":"Chapter","crossref-apx-prefix":"Appendix","crossref-sec-prefix":"Section","crossref-eq-prefix":"Equation","crossref-lof-title":"List of Figures","crossref-lot-title":"List of Tables","crossref-lol-title":"List of Listings","environment-proof-title":"Proof","environment-remark-title":"Remark","environment-solution-title":"Solution","listing-page-order-by":"Order By","listing-page-order-by-default":"Default","listing-page-order-by-date-asc":"Oldest","listing-page-order-by-date-desc":"Newest","listing-page-order-by-number-desc":"High to Low","listing-page-order-by-number-asc":"Low to High","listing-page-field-date":"Date","listing-page-field-title":"Title","listing-page-field-description":"Description","listing-page-field-author":"Author","listing-page-field-filename":"File Name","listing-page-field-filemodified":"Modified","listing-page-field-subtitle":"Subtitle","listing-page-field-readingtime":"Reading Time","listing-page-field-wordcount":"Word Count","listing-page-field-categories":"Categories","listing-page-minutes-compact":"{0} min","listing-page-category-all":"All","listing-page-no-matches":"No matching items","listing-page-words":"{0} words"},"metadata":{"block-headings":false,"number-depth":2,"knitr":{"opts_chunk":{"echo":false,"warning":false,"message":false}},"documentclass":"report","classoption":"twoside","fontsize":"11pt","geometry":["inner=1.5in","outer=1in","top=1in","bottom=1in","heightrounded"],"colorlinks":true,"linestretch":2,"code-block-bg":"#f8f8f8","code-block-border-left":true,"template-partials":["_extensions/Amherst-Statistics/amherst-thesis/before-title.tex","_extensions/Amherst-Statistics/amherst-thesis/title.tex"],"revealjs-plugins":[],"bibliography":["references.bib"],"csl":"includes/american-statistical-association.csl","department":"Mathematics and Statistics","advisors":"Professor Shu-Min Liao","submitted":2024},"extensions":{"book":{"selfContainedOutput":true}}}},"projectFormats":["amherst-thesis-pdf"]}